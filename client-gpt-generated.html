<html>
  <head>
    <meta charset="utf-8">
    <meta name="description" content="A dynamic story game with branching paths and multiple choices">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="/main.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <title id='title'>...</title>
<style>
  #picture,
  #video {
    display: block;
    margin: 0 auto;
    text-align: center;
  }
  #choices button {
    display: block;
    margin-top: 10px;
  }
  #background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-size: cover;
    z-index: -1;
  }
</style>
  </head>
  <body>

    <div id="main">
      <header>
        <h1 id="title"></h1>
      </header>
      <main>
        <div id="picture">
          <img src="">
        </div>
        <div id="video" style="display: none;">
          <video autoplay controls>
            <source src="" type="video/mp4">
          </video>
        </div>
        <p id="text"></p>
        <div id="choices">
        </div>
      </main>
      <footer>
        <p>Copyright 2022</p>
      </footer>
    </div>

    <script>
      function processTile(tileID) {
        var xhttp = new XMLHttpRequest();

        // update elements based on fetched data
        xhttp.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {

            var tile = JSON.parse(this.responseText);

            // title
            if (tile.title) {
              document.getElementById("title").innerHTML = tile.title;
            } else {
              document.getElementById("title").style.display = "none";
            }

            // picture
            if (tile.picture) {
              document.getElementById("picture").style.display = "block";
              document.getElementById("picture").firstElementChild.src = tile.picture;
              document.getElementById("background").style.backgroundImage = "url(" + tile.picture + ")";
            } else {
              document.getElementById("picture").style.display = "none";
            }

            // video
            if (tile.video) {
              document.getElementById("picture").style.display = "none";
              document.getElementById("video").style.display = "block";
              document.getElementById("video").firstElementChild.src="tile.video";
            }

            // text
            if (tile.text) {
              document.getElementById("text").innerHTML = tile.text;
            } else {
              document.getElementById("text").style.display = "none";
            }

            // choices
            if (tile.choices) {
              document.getElementById("choices").style.display = "block";
              var choicesHTML = "";
              for (var i = 0; i < tile.choices.length; i++) {
                choicesHTML += "<button type='button' onclick='processTile(" + tile.choices[i].to_tile + ")'>" + tile.choices[i].text + "</button>";
              }
              document.getElementById("choices").innerHTML = choicesHTML;
            } else {
              document.getElementById("choices").style.display = "none";
            }
          }
        };

        // fetch user data
        xhttp.open("GET", "/story/D3mons/1", true);
        xhttp.send();
      }
    </script>

    <!-- The main canvas consists in invisible DIVs, which get activated as player data is retrieved -->

    <button type="button" onclick=processTile("1")>Go</button>
      
    <div class="grid-title" id="title2"></div>

  </body>
</html>


